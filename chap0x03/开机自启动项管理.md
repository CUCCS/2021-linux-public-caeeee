# 开机自启动项管理
## 一、实验环境
+ Windows 10
+ VBox
+ Ubuntu 20.04 Server 64bit
+ asciinema
## 二、实验目的
- 动手实战systemd
- 参照第2章作业的要求，完整实验操作过程通过asciinema进行录像并上传，文档通过github上传
- 完成自查清单
## 三、实验过程
### 1. 安装Apache2
```
   $ sudo apt-get update
```
```
   $ sudo apt-get install apache2
```
### 2. 入门篇
- 3.2
[![asciicast](https://asciinema.org/a/RU2GR0SK3rCc1iUb5RrtDOOd3.svg)](https://asciinema.org/a/RU2GR0SK3rCc1iUb5RrtDOOd3)

- 3.3
[![asciicast](https://asciinema.org/a/TGiP3iyeEnmInIOCYQeJUoEFO.svg)](https://asciinema.org/a/TGiP3iyeEnmInIOCYQeJUoEFO)
- 3.4
[![asciicast](https://asciinema.org/a/JKh8VsLfTK9Zkpln4HeHyuBI1.svg)](https://asciinema.org/a/JKh8VsLfTK9Zkpln4HeHyuBI1)
- 3.5
[![asciicast](https://asciinema.org/a/qWlKc8DRmTm23Jg0pgDuwVFjo.svg)](https://asciinema.org/a/qWlKc8DRmTm23Jg0pgDuwVFjo)
- 3.6
[![asciicast](https://asciinema.org/a/gv1xWvSyxTg1nCsoE5KE1Sfwq.svg)](https://asciinema.org/a/gv1xWvSyxTg1nCsoE5KE1Sfwq)
- 4.1
[![asciicast](https://asciinema.org/a/bxwz51GxiGwFEXOhOvvfvfmbJ.svg)](https://asciinema.org/a/bxwz51GxiGwFEXOhOvvfvfmbJ)
- 4.2
[![asciicast](https://asciinema.org/a/q4OAsmsjOsligbK35Y3PIaM9c.svg)](https://asciinema.org/a/q4OAsmsjOsligbK35Y3PIaM9c)
- 4.3
[![asciicast](https://asciinema.org/a/JJpcFZ57W8jgQEOKmvhOfUk8R.svg)](https://asciinema.org/a/JJpcFZ57W8jgQEOKmvhOfUk8R)
- 4.4
[![asciicast](https://asciinema.org/a/3qzekOBdhbheRrBUSxpscgzJ9.svg)](https://asciinema.org/a/3qzekOBdhbheRrBUSxpscgzJ9)
- 5.2
[![asciicast](https://asciinema.org/a/HN0mtcCf2uzepWu6odB7X4Qof.svg)](https://asciinema.org/a/HN0mtcCf2uzepWu6odB7X4Qof)
- 5.3~6
[![asciicast](https://asciinema.org/a/vpfmrY18FXPWLch29bVbIn016.svg)](https://asciinema.org/a/vpfmrY18FXPWLch29bVbIn016)
- 7
[![asciicast](https://asciinema.org/a/4DBxnAr0jwViCMdZdsHEQMuQz.svg)](https://asciinema.org/a/4DBxnAr0jwViCMdZdsHEQMuQz)
### 3. 实战篇
- 1~3
[![asciicast](https://asciinema.org/a/mhyfeZUCaprP5knJKF14DGfUV.svg)](https://asciinema.org/a/mhyfeZUCaprP5knJKF14DGfUV)
- 4~9
[![asciicast](https://asciinema.org/a/CbaVniGWf309JqLcNCIgKOCCf.svg)](https://asciinema.org/a/CbaVniGWf309JqLcNCIgKOCCf)
## 四、自查清单
1. 如何添加一个用户并使其具备sudo执行程序的权限？

    - usermod -a -G sudo username
    修改 /etc/sudoers配置文件

    - 原文
    root ALL=(ALL) ALL
    - 加入
    username ALL=(ALL) ALL

2. 如何将一个用户添加到一个用户组？

    - usermod -a -G groupname username

3. 如何查看当前系统的分区表和文件系统详细信息？

    - `sudo fdisk -l / sudo sfdisk -l / cfdisk` 查看分区表
    - `df -h` 以更易读的方式显示目前磁盘空间和使用情况
    - `lsblk` 分区表和文件系统信息
    - `df -a/stat -f` 查看文件系统详细信息

4. 如何实现开机自动挂载Virtualbox的共享目录分区？

    在root用户文件 /etc/rc.local 中追加如下命令

    mount -t vboxsf sharing /mnt/share

5. 基于LVM（逻辑分卷管理）的分区如何实现动态扩容和缩减容量？

    - 扩容
    `lvextend -L size dir`
    - 缩减
    `lvreduce -L size dir`

6. 如何通过systemd设置实现在网络连通时运行一个指定脚本，在网络断开时运行另一个脚本？

  

    - [unit]Description=After network up After=network.target network-online.target [service] Type=oneshot ExecStart=YOUR_SCRIPT

     [Install]
     WantedBy=multi-user.target  连通是运行脚本

    - [unit]Description=Before network up After=network.target network-online.target [service] Type=oneshot ExecStart=YOUR_SCRIPT

     [Install]
     WantedBy=multi-user.target 断开时运行脚本


7. 如何通过systemd设置实现一个脚本在任何情况下被杀死之后会立即重新启动？实现杀不死？

    - 修改[Service]区块中对重启的定义 Restant = always
## 五、问题与解决

- 修改时区报错 `automatic time synchronization is enabled`
   
    解决办法
    ```
    timedatectl set-ntp no
    ```
    ```
    timedatectl set-ntp yes
    ```
    
    参考链接 http://www.jdccie.com/?p=3987
## 六、参考资料
- [Systemd 入门教程：实战篇](http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html)
- [Systemd 入门教程：命令篇](http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html)
- [修改时区报错解决方法](http://www.jdccie.com/?p=3987)
- [参考报告1](https://github.com/CUCCS/linux-2020-LyuLumos/blob/ch0x03/ch0x03/report3.md)
- [参考报告2](https://github.com/CUCCS/linux-2020-ProgramLove7/blob/chap0x03/chap0x03/chap3.md)